<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!--Converted with LaTeX2HTML 98.2 beta6 (August 14th, 1998)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>The spectral line fitting window</TITLE>
<META NAME="description" CONTENT="The spectral line fitting window">
<META NAME="keywords" CONTENT="sun243">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<LINK REL="STYLESHEET" HREF="sun243.css">
<LINK REL="next" HREF="node38.html">
<LINK REL="previous" HREF="node35.html">
<LINK REL="up" HREF="node7.html">
<LINK REL="next" HREF="node37.html">
</HEAD>
<BODY >
<BR> <HR>
<A NAME="tex2html464"
 HREF="node37.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html462"
 HREF="node7.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html456"
 HREF="node35.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>   <A HREF="sun243.html#stardoccontents"><IMG
 WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0"
 SRC="contents_motif.gif"
 ALT="101"></A>
<BR>
<B> Next:</B> <A NAME="tex2html465"
 HREF="node37.html">Saving the results</A>
<BR>
<B>Up:</B> <A NAME="tex2html463"
 HREF="node7.html">Help for individual windows</A>
<BR>
<B> Previous:</B> <A NAME="tex2html457"
 HREF="node35.html">The generate spectra from interpolated lines window</A>
<BR> <HR> <P>

<!--End of Navigation Panel-->

<H2><A NAME="SECTION000416000000000000000">
The spectral line fitting window</A>
</H2>

<P>
The spectral line fitting window allows you to measure the wavelength
and equivalent width of emission or absorption lines and to fit
various standard profiles to the lines.

<P>
The standard profiles offered are Gaussian, Lorentzian and Voigt, as
well as a model independent intensity analysis measure.

<P>
<DIV ALIGN="CENTER">
 <IMG
 WIDTH="322" HEIGHT="434" ALIGN="BOTTOM" BORDER="0"
 SRC="linefitwindow.gif"
 ALT="2388">
 
</DIV>

<P>
<B>Background type:</B> Choose a type of background estimate to
be subtracted from the spectrum before fitting. The choices are
<B>Constant</B> and <B>Polynomial</B>. If you have already
subtracted the background from the spectrum, or have applied a
normalisation (so that the background is flat, usually with a value of
1) then you need to choose <B>Constant</B> and provide a suitable
value. Otherwise choose <B>Polynomial</B> and select a spectrum
from the list in <B>Background fit</B>.

<P>
<B>Background fit</B>: For emission lines you would normally
define a background spectrum using the polynomial fitting tool. In
this case select the <B>Polynomial</B> option and choose the
background spectrum you have created. Note that you can actually use
any spectrum from the global list as the background (so you are not
restricted to what <I>SPLAT-VO</I>, provides) but if you choose the same
spectrum as is being measured then a background of 0 is assumed.

<P>
The default background should be set to the first polynomial found on
the global list.

<P>
<B>Use error as weights</B>: If your spectrum has associated
error measurements then you can select this checkbox to use the errors
as weights in the fitting procedure.

<P>
<B>Coordinate ranges</B>: This table shows the upper and lower
coordinate range for each line that you want to measure.

<P>
To add a line to this list press the <B>Add</B> button. Now drag
out a region on the plot display area that encompasses the spectral
line. You should now see a yellow rectangle over the line:

<P>
<DIV ALIGN="CENTER">
 <IMG
 WIDTH="493" HEIGHT="356" ALIGN="BOTTOM" BORDER="0"
 SRC="linefitplotwindow.gif"
 ALT="2403">
 
</DIV>

<P>
Note that the rectangle is just defining a range, not an area, so you
just need to worry about its width and position along the X axis, not
its height.

<P>
To adjust the rectangle position select it and either drag it around,
or use the grips on the exterior to resize it. You can see the
physical extent of the region in the <B>Coordinate ranges:</B>
table. To set these to a known value double click on the value you'd
like to set, make the change, and then press <TT>&lt;Return&gt;</TT> to
apply it.

<P>
The extents of lines can be saved to a simple text file and
re-read. The format is simple. It should have two fields separated by
whitespace or commas. Comments are indicated by lines starting with a
hash (#) and are ignored.

<P>
<B><FONT SIZE="+1">Types of fit:</FONT></B>
<BLOCKQUOTE>
 Once you have defined the extents of your spectral lines and chosen a
 background, you can proceed to make the measurements you want. Just
 select the types of fit you want from the list <B>Gaussian</B>,
 <B>Lorentzian</B> and <B>Voigt</B>. Note you can de-select
 all these and just get a <B>Quick</B> measurement.

<P>
All types except <B>Quick</B> use a non-linear least squares
 (Levenberg-Marquardt) minimisation stage to perform the actual fit of
 the model to the data (possibly with weighting, if the spectrum has
 any error measurements). So it is necessary to have some idea of the
 shape of the line, before attempting to fit it. This job is done by
 the <B>Quick</B> fit, which is compulsory. The description of
 each of the types and what their measurements represent is given
 below.

<P>
<B>Quick</B>: The default line measurement type. This is based on
 the ABLINE technique described in the <A HREF="/star/docs/sun86.htx/sun86.html#xref_">FIGARO</A>
 documentation. This just uses an analysis of the intensities in the
 selected region and the chosen background. The results you get are:

<UL><LI><TT>ID</TT>, just a unique integer to label the line. This is
         the same for all fits.

<LI><TT>Peak</TT>, the peak, background subtracted, intensity in
         the region. Negative for absorption lines.

<LI><TT>Centre</TT>, the position of the median value <I>i.e.</I> that
         for which half of the total, background subtracted, area of
         the line, within the given region, lies to the left and right.

<LI><TT>Width</TT>, width of the line. For a Gaussian this would
         be <IMG
 WIDTH="26" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.gif"
 ALT="$\pm 1$">
standard deviations wide.

<LI><TT>Equiv</TT>, the equivalent width of the line. This will be
         0 if a zero background is given or assumed.

<LI><TT>Asym</TT>, an asymmetry value for the line. This is a
         measure of the relative displacement of the centre of the
         line from the centre as measured by the upper and lower
         half widths.
 
</UL>

<P>
<B>Gaussian</B>: The formula used for the Gaussian is:
 <BR><P></P>
<DIV ALIGN="CENTER">

<!-- MATH
 \begin{displaymath}
y(r) = A * exp\left( -0.5 * \left(\frac{x-c}{\sigma}\right)^{2}\right)
\end{displaymath}
 -->


<IMG
 WIDTH="257" HEIGHT="51" BORDER="0"
 SRC="img4.gif"
 ALT="\begin{displaymath}
y(r) = A * exp\left( -0.5 * \left(\frac{x-c}{\sigma}\right)^{2}\right)
\end{displaymath}">
</DIV>
<BR CLEAR="ALL">
<P></P>
where <I>A</I> is the scale height, <I>r</I> is the distance from the centre,
 <I>c</I> is the centre, <I>x</I> the distance from the origin and <IMG
 WIDTH="16" HEIGHT="18" ALIGN="BOTTOM" BORDER="0"
 SRC="img5.gif"
 ALT="$\sigma$">
is
 the Gaussian sigma. The <I>y</I> values are background subtracted.

<P>
The values measured for this line shape are:

<UL><LI><TT>ID</TT>, integer identifier (same as other fits).

<LI><TT>Peak</TT>, the Gaussian peak (<I>A</I>).

<LI><TT>Centre</TT>, the position of the Gaussian peak (<I>c</I>).

<LI><TT>Width</TT>, the Gaussian sigma (<IMG
 WIDTH="16" HEIGHT="18" ALIGN="BOTTOM" BORDER="0"
 SRC="img5.gif"
 ALT="$\sigma$">).

<LI><TT>Flux</TT>, the integrated flux of the Gaussian.

<LI><TT>Rms</TT>, the root mean square difference between the
         Gaussian and the line data.
 
</UL>

<P>
<B>Lorentzian</B>: The formula used for the Lorentzian is:
 <BR><P></P>
<DIV ALIGN="CENTER">

<!-- MATH
 \begin{displaymath}
y(r) = \frac{A}{1+0.5*(\frac{x-c}{w})^{2}}
\end{displaymath}
 -->


<IMG
 WIDTH="170" HEIGHT="46" BORDER="0"
 SRC="img6.gif"
 ALT="\begin{displaymath}
y(r) = \frac{A}{1+0.5*(\frac{x-c}{w})^{2}}
\end{displaymath}">
</DIV>
<BR CLEAR="ALL">
<P></P>
where <I>A</I> is the scale height, <I>r</I> is the distance from the centre,
 <I>c</I> is the centre, <I>x</I> the distance from the origin and <I>w</I> the
 Lorentzian width. The <I>y</I> values are background subtracted. The full
 width half maximum (<I>fwhm</I>) of the curve is:
 <BR><P></P>
<DIV ALIGN="CENTER">

<!-- MATH
 \begin{displaymath}
fwhm = w*2\sqrt{2}
\end{displaymath}
 -->


<IMG
 WIDTH="131" HEIGHT="26" BORDER="0"
 SRC="img7.gif"
 ALT="\begin{displaymath}
fwhm = w*2\sqrt{2}
\end{displaymath}">
</DIV>
<BR CLEAR="ALL">
<P></P>

<P>
The values measured for this line shape are:

<UL><LI><TT>ID</TT>, integer identifier (same as other fits).

<LI><TT>Peak</TT>, the Lorentzian peak (<I>A</I>).

<LI><TT>Centre</TT>, the position of the Lorentzian peak (<I>c</I>).

<LI><TT>Width</TT>, the Lorentzian width (<I>w</I>).

<LI><TT>Flux</TT>, the integrated flux of the Lorentzian.

<LI><TT>Rms</TT>, the root mean square difference between the
         Lorentzian and the line data.
 
</UL>

<P>
<B>Voigt</B>: The formula for a Voigt profile (a convolution of a
 Gaussian and Lorentzian) is:
 <BR><P></P>
<DIV ALIGN="CENTER">

<!-- MATH
 \begin{displaymath}
K(a,b) = \frac{b}{\pi}\int_{-\infty}^{\infty}\frac{\mathrm{exp}(-t^{2})}{(a-t)^{2}+b^{2}}dt
\end{displaymath}
 -->


<IMG
 WIDTH="237" HEIGHT="46" BORDER="0"
 SRC="img8.gif"
 ALT="\begin{displaymath}
K(a,b) = \frac{b}{\pi}\int_{-\infty}^{\infty}\frac{\mathrm{exp}(-t^{2})}{(a-t)^{2}+b^{2}}dt
\end{displaymath}">
</DIV>
<BR CLEAR="ALL">
<P></P>
where:
 <BR><P></P>
<DIV ALIGN="CENTER">

<!-- MATH
 \begin{displaymath}
a = \sqrt{\ln{2}} \, \left(\frac{x-c}{\sigma}\right)
\end{displaymath}
 -->


<IMG
 WIDTH="133" HEIGHT="42" BORDER="0"
 SRC="img9.gif"
 ALT="\begin{displaymath}
a = \sqrt{\ln{2}} \, \left(\frac{x-c}{\sigma}\right)
\end{displaymath}">
</DIV>
<BR CLEAR="ALL">
<P></P>
and
 <BR><P></P>
<DIV ALIGN="CENTER">

<!-- MATH
 \begin{displaymath}
b = \sqrt{\ln{2}} \, \left(\frac{w}{\sigma}\right)
\end{displaymath}
 -->


<IMG
 WIDTH="109" HEIGHT="42" BORDER="0"
 SRC="img10.gif"
 ALT="\begin{displaymath}
b = \sqrt{\ln{2}} \, \left(\frac{w}{\sigma}\right)
\end{displaymath}">
</DIV>
<BR CLEAR="ALL">
<P></P>
In these equations <I>c</I> is the central wavelength, <I>x</I> the distance
 from the origin, <IMG
 WIDTH="16" HEIGHT="18" ALIGN="BOTTOM" BORDER="0"
 SRC="img5.gif"
 ALT="$\sigma$">
is the
 Gaussian width and <I>w</I> the Lorentzian width. Which is complex to
 solve. However, if we take a complex variable <I>z</I>=<I>a</I>+<I>ib</I>, then the
 Voigt function is, within a scale factor (<I>A</I>), also the real part of
 the complex error function:
 <BR><P></P>
<DIV ALIGN="CENTER">

<!-- MATH
 \begin{displaymath}
w(z) = \mathrm{exp}(-z^{2}) \, \mathrm{erfc}(-iz)
\end{displaymath}
 -->


<IMG
 WIDTH="186" HEIGHT="29" BORDER="0"
 SRC="img11.gif"
 ALT="\begin{displaymath}
w(z) = \mathrm{exp}(-z^{2}) \, \mathrm{erfc}(-iz)
\end{displaymath}">
</DIV>
<BR CLEAR="ALL">
<P></P>
which has been approximated by various numerical codes. Using this
 fact with a non-linear minimisation routine (plus some derivatives) is
 how SPLAT performs its Voigt fitting.

<P>
The values measured for this line shape are:

<UL><LI><TT>ID</TT>, integer identifier (same as other fits).

<LI><TT>Peak</TT>, the Voigt peak (<I>A</I>).

<LI><TT>Centre</TT>, the position of the Voigt peak (<I>c</I>).

<LI><TT>Gwidth</TT>, the Gaussian width (<IMG
 WIDTH="16" HEIGHT="18" ALIGN="BOTTOM" BORDER="0"
 SRC="img5.gif"
 ALT="$\sigma$">).

<LI><TT>Lwidth</TT>, the Lorentzian width (<I>w</I>).

<LI><TT>Flux</TT>, the integrated flux of the Voigt profile.

<LI><TT>Rms</TT>, the root mean square difference between the
         Voigt and the line data.
 
</UL>
</BLOCKQUOTE>

<P>
<BR><HR>
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"></A>

<UL>
<LI><A NAME="tex2html466"
 HREF="node37.html">Saving the results</A>
</UL>
<!--End of Table of Child-Links-->
<BR> <HR>
<A NAME="tex2html464"
 HREF="node37.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html462"
 HREF="node7.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html456"
 HREF="node35.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>   <A HREF="sun243.html#stardoccontents"><IMG
 WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0"
 SRC="contents_motif.gif"
 ALT="101"></A>
<BR>
<B> Next:</B> <A NAME="tex2html465"
 HREF="node37.html">Saving the results</A>
<BR>
<B>Up:</B> <A NAME="tex2html463"
 HREF="node7.html">Help for individual windows</A>
<BR>
<B> Previous:</B> <A NAME="tex2html457"
 HREF="node35.html">The generate spectra from interpolated lines window</A>
<BR> <HR> <P>

<!--End of Navigation Panel-->
<ADDRESS>
<I>SPLAT-VO -- A VO-enabled Spectral Analysis Tool<BR>Starlink User Note 243<BR>Peter W. Draper<BR>24 February 2005<BR>E-mail:<A HREF="mailto:splat@star.rl.ac.uk">splat@star.rl.ac.uk</A><BR><BR>Copyright &copy 2001-2005 Council for the Central Laboratory of the

Research Councils<BR></I>
</ADDRESS>
</BODY>
</HTML>
